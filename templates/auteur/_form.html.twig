{{ form_start(form) }}
  {# Disposition: même conteneur, form à gauche, photo à droite #}
  <div class="flex flex-col lg:flex-row gap-6 items-start">
    {# Colonne gauche: tous les champs sauf _token et photoFile #}
    <div class="flex-1 w-full">
      <div class="space-y-3">
        {% for field in form %}
          {% set name = field.vars.name %}
          {% if name == '_token' or name == 'photoFile' %}
            {# ignoré ici, géré ailleurs #}
          {% else %}
            <div class="space-y-1">
              {{ form_label(field, null, {'label_attr': {'class': 'block text-xs font-semibold tracking-wide text-slate-600 dark:text-slate-300'}}) }}
              {{ form_widget(field, {'attr': {'class': 'mt-1 block w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100 text-sm px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500'}}) }}
              {{ form_errors(field) }}
            </div>
          {% endif %}
        {% endfor %}
      </div>

      <div class="flex justify-end pt-4">
        <button class="{{ button_class|default('px-5 py-2.5 text-sm font-semibold text-white rounded-lg bg-black hover:bg-slate-900 shadow-md hover:shadow-lg') }}">{{ button_label|default('Ajouter') }}</button>
      </div>
    </div>

    {# Colonne droite: aperçu + champ photoFile #}
    <div class="w-full lg:w-1/3">
      <h2 class="text-sm font-semibold mb-4 text-slate-700 dark:text-slate-100">Photo</h2>
      <div class="flex flex-col items-center">
        {% if auteur is defined and auteur.photo %}
          <img id="photoPreview" src="{{ asset('uploads/auteurs/' ~ auteur.photo) }}" class="w-12 h-12 rounded-full object-cover border border-slate-200 dark:border-slate-700 mb-4" alt="">
        {% else %}
          <img id="photoPreview" src="{{ asset('admin/img/placeholder-avatar.png') }}" class="w-12 h-12 rounded-full object-cover border border-slate-200 dark:border-slate-700 mb-4" alt="">
        {% endif %}

        {% if form.photoFile is defined %}
          <div class="w-full">
            {{ form_label(form.photoFile, 'Changer now', {'label_attr': {'class': 'block text-xs font-semibold tracking-wide text-slate-600 dark:text-slate-300'}}) }}
            {{ form_widget(form.photoFile, {'attr': {'class': 'mt-1 block w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100 text-sm px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500'}}) }}
            {{ form_errors(form.photoFile) }}
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  {# CSRF rendu mais caché #}
  {% if form._token is defined %}
    {{ form_widget(form._token) }}
  {% endif %}
{{ form_end(form, { 'render_rest': false }) }}

{# Aperçu instantané de l'image sélectionnée #}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const input = document.querySelector('input[type="file"][name$="[photoFile]"]');
    const preview = document.getElementById('photoPreview');
    if (input && preview) {
      input.addEventListener('change', function (e) {
        const file = e.target.files && e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (ev) => { preview.src = ev.target.result; };
        reader.readAsDataURL(file);
      });
    }
  });
}</script>
