{% extends 'base1.html.twig' %}

{% block title %}Admin Forum Posts{% endblock %}

{% block body %}
<style>
    .example-wrapper {
        margin: 1em 0 1em auto;
        max-width: 800px;
        width: 95%;
        font: 18px/1.5 sans-serif;
    }
    .table-container {
        max-width: 1000px;
        margin: 1em 0 1em auto;
        padding: 0 20px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
    }
    th, td {
        border: 1px solid #ccc;
        padding: 8px;
        text-align: left;
    }
    thead {
        background-color: #f0f0f0;
    }
    .badge-published {
        background: #16a34a;
        color: white;
        padding: 3px 6px;
        border-radius: 4px;
        font-size: 12px;
    }
    .badge-disabled {
        background: #dc2626;
        color: white;
        padding: 3px 6px;
        border-radius: 4px;
        font-size: 12px;
    }
    .toggle-btn {
        padding: 4px 7px;
        border-radius: 4px;
        color: white;
        font-size: 12px;
    }
    .btn-enable { background: #16a34a; }
    .btn-disable { background: #dc2626; }
</style>

<div class="p-6">
    <h1 class="text-2xl font-bold mb-4">Administration des Posts</h1>

    {% for message in app.flashes('success') %}
        <div class="bg-green-100 text-green-700 p-3 rounded mb-3">{{ message }}</div>
    {% endfor %}

    <div class="table-container overflow-x-auto">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Titre</th>
                    <th>Contenu</th>
                    <th>Auteur</th>
                    <th>Commentaires</th>
                    <th>Statut</th>
                    <th>Actions</th>
                    <th>Toggle</th>
                </tr>
            </thead>
            <tbody>
                {% for post in forum_posts %}
                    <tr>
                        <td>{{ post.id }}</td>
                        <td>{{ post.titre }}</td>
                        <td>{{ post.contenu|length > 50 ? post.contenu|slice(0, 50) ~ '...' : post.contenu }}</td>
                        <td>{{ post.user.username }}</td>
                        <td>{{ post.comments|length }}</td>

                        {# ----------- STATUT (enabled) ---------- #}
                        <td>
                            {% if post.enabled %}
                                <span class="badge-published">Publié</span>
                            {% else %}
                                <span class="badge-disabled">Désactivé</span>
                            {% endif %}
                        </td>

                        {# ----------- ACTIONS VIEW / EDIT / DELETE ---------- #}
                        <td class="actions flex">
                            <a href="{{ path('app_forum_post_show', {'id': post.id}) }}" class="bg-blue-500 text-white px-2 py-1 rounded text-sm">Voir</a>

                            <a href="{{ path('app_forum_post_edit', {'id': post.id}) }}" class="bg-gray-500 text-white px-2 py-1 rounded text-sm">Modifier</a>

                            <form method="post" action="{{ path('app_forum_post_delete', {'id': post.id}) }}" onsubmit="return confirm('Voulez-vous vraiment supprimer ce post ?');">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ post.id) }}">
                                <button class="bg-red-500 text-white px-2 py-1 rounded text-sm">Supprimer</button>
                            </form>
                        </td>

                        {# ----------- BOUTON ENABLE/DISABLE ---------- #}
                        <td>
                            <a href="{{ path('app_post_toggle', {'id': post.id}) }}"
                               class="toggle-btn {% if post.enabled %}btn-disable{% else %}btn-enable{% endif %}">
                                {% if post.enabled %}Désactiver{% else %}Activer{% endif %}
                            </a>
                        </td>

                    </tr>
                {% else %}
                    <tr>
                        <td colspan="8" class="text-center">Aucun post trouvé.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <a href="{{ path('app_forum_post_new') }}" class="mt-4 inline-block bg-green-500 text-white px-4 py-2 rounded">Créer un nouveau post</a>
</div>
{% endblock %}
