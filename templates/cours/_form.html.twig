{{ form_start(form) }}
  {% set forceRight = always_right|default(false) %}
  {% set bgRight = background_right|default(false) %}
  <div class="{% if forceRight and not bgRight %}flex flex-row gap-6 items-stretch{% elseif not bgRight %}grid grid-cols-1 lg:grid-cols-3 gap-6{% else %}block{% endif %}">
    {# Colonne gauche: tous les champs sauf _token et imageFile/thumbnail #}
    <div class="{% if forceRight and not bgRight %}flex-1 w-full{% elseif not bgRight %}lg:col-span-2{% else %}w-full{% endif %}">
      <div class="space-y-3">
        {% for field in form %}
          {% set name = field.vars.name %}
          {% if name in ['_token','imageFile','thumbnail','cover'] %}
            {# ignoré ici, géré ailleurs #}
          {% else %}
            <div class="space-y-1">
              {{ form_label(field, null, {'label_attr': {'class': 'block text-xs font-semibold tracking-wide text-slate-900 dark:text-white'}}) }}
              {{ form_widget(field, {'attr': {'class': 'mt-1 block w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 text-slate-900 dark:text-white placeholder-slate-700 dark:placeholder-slate-300 text-sm px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500'}}) }}
            </div>
          {% endif %}
        {% endfor %}
      </div>

      <div class="flex justify-end pt-4">
        <button class="{{ button_class|default('px-5 py-2.5 text-sm font-bold text-white rounded-lg bg-gradient-to-tl from-emerald-600 to-emerald-400 shadow-md hover:shadow-xl') }}">{{ button_label|default('Enregistrer') }}</button>
      </div>
    </div>

    {% if not bgRight %}
    {# Colonne droite: visuel/aperçu + champ image si disponible #}
    <div class="{% if forceRight %}flex-1 w-full self-stretch flex flex-col{% endif %}">
      <div class="flex flex-col items-center h-full">
        {# Prévoir un aperçu si un champ image existe #}
        {% set hasImageField = (form.imageFile is defined) or (form.thumbnail is defined) or (form.cover is defined) %}
        <div class="flex-1 w-full mb-4">
          <img id="courseImagePreview" src="{{ asset('front/img/course-1.jpg') }}" class="w-full h-full object-cover rounded-xl border border-slate-200 dark:border-slate-700" style="min-height: 18rem;" alt="">
        </div>

        {% if form.imageFile is defined %}
          <div class="w-full">
            {{ form_label(form.imageFile, 'Image du cours', {'label_attr': {'class': 'block text-xs font-semibold tracking-wide text-slate-900 dark:text-white'}}) }}
            {{ form_widget(form.imageFile, {'attr': {'class': 'mt-1 block w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 text-slate-900 dark:text-white placeholder-slate-700 dark:placeholder-slate-300 text-sm px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500'}}) }}
          </div>
        {% elseif form.thumbnail is defined %}
          <div class="w-full">
            {{ form_label(form.thumbnail, 'Image du cours', {'label_attr': {'class': 'block text-xs font-semibold tracking-wide text-slate-900 dark:text-white'}}) }}
            {{ form_widget(form.thumbnail, {'attr': {'class': 'mt-1 block w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 text-slate-900 dark:text-white placeholder-slate-700 dark:placeholder-slate-300 text-sm px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500'}}) }}
          </div>
        {% elseif form.cover is defined %}
          <div class="w-full">
            {{ form_label(form.cover, 'Image du cours', {'label_attr': {'class': 'block text-xs font-semibold tracking-wide text-slate-900 dark:text-white'}}) }}
            {{ form_widget(form.cover, {'attr': {'class': 'mt-1 block w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 text-slate-900 dark:text-white placeholder-slate-700 dark:placeholder-slate-300 text-sm px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500'}}) }}
          </div>
        {% endif %}
      </div>
    </div>
    {% endif %}
  </div>

  {# CSRF #}
  {% if form._token is defined %}
    {{ form_widget(form._token) }}
  {% endif %}
{{ form_end(form, { 'render_rest': false }) }}

{# Aperçu instantané si un input fichier est présent #}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const preview = document.getElementById('courseImagePreview');
    const fileInput = document.querySelector('input[type="file"][name$="[imageFile]"]')
                    || document.querySelector('input[type="file"][name$="[thumbnail]"]')
                    || document.querySelector('input[type="file"][name$="[cover]"]');
    if (preview && fileInput) {
      fileInput.addEventListener('change', function (e) {
        const file = e.target.files && e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (ev) => { preview.src = ev.target.result; };
        reader.readAsDataURL(file);
      });
    }
  });
}</script>
